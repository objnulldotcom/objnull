
@{
    ViewBag.Title = "TreeNewBee - 象空";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
@section head{
    <!--highlight.js-->
    <link href="~/Scripts/HighlightJs/default.min.css" rel="stylesheet" />
    <script src="~/Scripts/HighlightJs/highlight.min.js"></script>
    <!--marked-->
    <script src="~/Scripts/Marked/marked.js"></script>
    <!--simplePagination-->
    <script src="~/Scripts/SimplePagination/jquery.simplePagination.js"></script>
    <script>
        $(function () {
            $("#PreBox").hide();
            //代码高亮插件
            marked.setOptions({
                highlight: function (code) {
                    return hljs.highlightAuto(code).value;
                },
                breaks: true,
                sanitize: true
            });

            //取消
            $("#BtnCancel").click(function () {
                $("#CommentBox").hide();
            });
            //评论面板
            $("#BtnCmt").click(function () {
                $("#BtnCmt").parent().removeClass("active");
                $("#BtnPre").parent().removeClass("active");
                $("#BtnCmt").parent().addClass("active");
                $("#PreBox").hide();
                $("#EditBox").show();
            });
            //预览面板
            $("#BtnPre").click(function () {
                $("#BtnCmt").parent().removeClass("active");
                $("#BtnPre").parent().removeClass("active");
                $("#BtnPre").parent().addClass("active");
                $("#EditBox").hide();
                $("#PreBox").show();

                $("#PreBox").html("");
                $("#PreBox").html(marked($("#CmtTxt").val()));
            });
            //确定
            $("#BtnConfirm").click(function () {
                var title = $("#TxtTitle").val();
                var txt = $("#CmtTxt").val();
                if (txt.length == 0) {
                    swal("请填写评论内容");
                    return;
                }
                if (getBt(txt) > 2000) {
                    swal("评论最多2000字节，当前" + getBt(txt) + "字节");
                    return;
                }
                $.ajax({
                    url: "@Url.Action("NewNewBee", "Home")",
                    data: { title: title, mdTxt: txt, mdValue: marked(txt) },
                    type: "post",
                    success: function (result) {
                        if (result.msg == "done") {
                            $("#CmtTxt").val("");
                            $("#BtnCmt").click();
                            NewBeePage(1);
                        } else {
                            swal(result.msg);
                        }
                    }
                });
            });

            NewBeePage(1);
        });

        //NewBeePage
        function NewBeePage(index) {
            var pageSize = 15;
            var postData = { pageSize: pageSize, pageNum: index }
            $.ajax({
                url: "@Url.Action("NewBeePage", "Home")",
                type: "Post",
                data: postData,
                success: function (result) {
                    $("#NewBeePage").html(result);
                    var total = $("#TotalCount").val();
                    if (total <= pageSize) {
                        return;
                    }
                    $("#NBPager").pagination({
                        items: total,
                        itemsOnPage: pageSize,
                        currentPage: $("#CurrentPage").val(),
                        prevText: "<",
                        nextText: ">",
                        listStyle: "pagination pagination-sm",
                        hrefTextPrefix: "javascript:;",
                        onPageClick: function (pageNumber, event) {
                            NewBeePage(pageNumber);
                        }
                    });
                }
            });
        }
    </script>
}
<div class="row" style="padding-top: 10px">
    <div class="col-md-12" style="height: 100px; margin-bottom: 10px">
    </div>
</div>
<div class="row">
    <div id="NewBeePage" class="col-md-12">

    </div>
</div>
<div class="row">
    <div class="col-md-8 col-md-offset-1">
        <div class="row" style="padding: 20px 0px 10px 0px">
            <div class="col-md-12">
                <input id="TxtTitle" class="form-control" type="text" placeholder="标题" />
            </div>
        </div>
        <div class="row">
            <div class="col-md-12" style="margin-bottom: 10px">
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="javascript:;" id="BtnCmt">Tree</a></li>
                    <li role="presentation"><a href="javascript:;" id="BtnPre">预览</a></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div id="PreBox" class="col-md-12 mdv" style="min-height: 50px">
            </div>
            <div id="EditBox" class="col-md-12">
                <span>查看&nbsp;<a href="http://mvc.objnull.com/zh/Demo/MarkDownSyntax" target="_blank">MarkDown语法</a></span>
                <textarea id="CmtTxt" class="form-control" rows="5" style="resize:vertical;"></textarea>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 text-center" style="margin: 10px 0px">
                <button id="BtnConfirm" class="btn btn-default">确定</button>
            </div>
        </div>
    </div>
</div>

